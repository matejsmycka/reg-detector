<?xml version="1.0" encoding="utf-8" ?>
<stateResolver>
    <defaultOutput priority="99" state="OK" description="Enki service is correctly running"/>

    <extractor name="default">
        <getAttribute path="EnkiOperationExecutor.connected" key="Connected" type="String" />
        <getAttribute path="EnkiOperationExecutor.failureInfo.time" key="FailureTime" type="DateTime" />
        <getAttribute path="EnkiOperationExecutor.failureInfo.reconnectionAttempts" key="ReconnectionAttempts" type="Int" />
    </extractor>

    <interval axisName="FailureTime" intervalName="TimeWarning" to="30" />
    <interval axisName="FailureTime" intervalName="TimeError" from="30" />
    <interval axisName="ReconnectionAttempts" intervalName="AttemptsWarning" to="3" />
    <interval axisName="ReconnectionAttempts" intervalName="AttemptsError" from="3" />

    <multiSwitch name="TimeSwitch" choice="Connected">
        <switchNode case="false" choice="FailureTime">
            <switchNode case="TimeWarning">
                <result key="State" value="Warning" />
                <result key="Priority" value="10" />
                <result key="Description" value="Enki's connection with AD is down" />
            </switchNode>
            <switchNode case="TimeError">
                <result key="State" value="Error" />
                <result key="Priority" value="0" />
                <result key="Description" value="Enki's connection with AD is down too long" />
            </switchNode>
        </switchNode>
    </multiSwitch>

    <multiSwitch name="AttemptsSwitch" choice="Connected">
        <switchNode case="false" choice="ReconnectionAttempts">
            <switchNode case="AttemptsWarning">
                <result key="State" value="Warning" />
                <result key="Priority" value="10" />
                <result key="Description" value="Enki's connection with AD is down" />
            </switchNode>
            <switchNode case="AttemptsError">
                <result key="State" value="Error" />
                <result key="Priority" value="0" />
                <result key="Description" value="Enki's connection with AD is down too long" />
            </switchNode>
        </switchNode>
    </multiSwitch>
            
</stateResolver>
