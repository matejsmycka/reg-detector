<ApplicationDef>
	<Application>
		<Name>Mozilla Firefox Quantum</Name>
		<Description>Mozilla Firefox (or simply Firefox) is a free and open-source web browser developed by the Mozilla Foundation and its subsidiary, the Mozilla Corporation.</Description>
		<Publisher>Mozilla</Publisher>
		<AutoInstall>True</AutoInstall>
		<UserDocumentation>https://support.mozilla.org/en-US/</UserDocumentation>
		<Icon>firefoxQ.png</Icon>
	</Application>
	<Downloads>
		<Download DeploymentType="DeploymentType1">
			<PrefetchScript>
			$Version = (ConvertFrom-JSON (Invoke-WebRequest -URI "https://product-details.mozilla.org/1.0/firefox_versions.json").Content).FIREFOX_ESR
			$URL = "https://download.mozilla.org/?product=firefox-$Version-SSL&amp;os=win64&amp;lang=en-US"
			$Version = $Version -replace "esr",""
			$FullVersion = $Version
			</PrefetchScript>
			<URL></URL>
			<DownloadFileName>FirefoxQuantumx64.exe</DownloadFileName>
			<ExtraCopyFunctions>&amp; $ScriptRoot\7za.exe x "$TempDir\FirefoxQuantumx64.exe" -o"$TempDir\FireFoxqTempx64" -y
			Push-Location
			Copy-Item -Path "$ScriptRoot`\Extra\Mozilla Firefox Quantum\*" -exclude "firefox.ini" -Destination "$TempDir\FireFoxqTempx64\core" -Recurse
			
			&amp;$ScriptRoot\7za.exe a -r -t7z $TempDir\FireFoxqTempx64\app.7z -mx -m0=BCJ2 -m1=LZMA:d24 -m2=LZMA:d19 -m3=LZMA:d19 -mb0:1 -mb0s1:2 -mb0s2:3 $TempDir\FireFoxqTempx64\*

			Invoke-WebRequest -Uri "https://hg.mozilla.org/mozilla-central/raw-file/tip/other-licenses/7zstub/firefox/7zSD.Win32.sfx" -OutFile $TempDir\FireFoxqTempx64\7zSD.sfx -ErrorAction Ignore
			Invoke-WebRequest -Uri "https://hg.mozilla.org/mozilla-central/raw-file/tip/browser/installer/windows/app.tag" -OutFile $TempDir\FireFoxqTempx64\app.tag -ErrorAction Ignore

			cmd /c copy /B $TempDir\FireFoxqTempx64\7zSD.sfx+$TempDir\FireFoxqTempx64\app.tag+$TempDir\FireFoxqTempx64\app.7z $DestinationPath\FirefoxQuantumx64.exe

			Pop-Location
			</ExtraCopyFunctions>
			<FullVersion></FullVersion>
			<Version></Version>
			<AppRepoFolder>x64EN</AppRepoFolder>
		</Download>
		<Download DeploymentType="DeploymentType2">
			<PrefetchScript>
			$Version = (ConvertFrom-JSON (Invoke-WebRequest -URI "https://product-details.mozilla.org/1.0/firefox_versions.json").Content).FIREFOX_ESR	
			$URL = "https://download.mozilla.org/?product=firefox-$Version-SSL&amp;os=win&amp;lang=en-US"
			$Version = $Version -replace "esr",""
			$FullVersion = $Version
			</PrefetchScript>
			<URL></URL>
			<DownloadFileName>FirefoxQuantumx86.exe</DownloadFileName>
			<ExtraCopyFunctions>
			&amp; $ScriptRoot\7za.exe x "$TempDir\FirefoxQuantumx86.exe" -o"$TempDir\FireFoxqTempx86" -y
			Push-Location
			Copy-Item -Path "$ScriptRoot`\Extra\Mozilla Firefox Quantum\*" -exclude "firefox.ini" -Destination "$TempDir\FireFoxqTempx86\core" -Recurse
			
			&amp;$ScriptRoot\7za.exe a -r -t7z $TempDir\FireFoxqTempx86\app.7z -mx -m0=BCJ2 -m1=LZMA:d24 -m2=LZMA:d19 -m3=LZMA:d19 -mb0:1 -mb0s1:2 -mb0s2:3 $TempDir\FireFoxqTempx86\*

			Invoke-WebRequest -Uri "https://hg.mozilla.org/mozilla-central/raw-file/tip/other-licenses/7zstub/firefox/7zSD.Win32.sfx" -OutFile $TempDir\FireFoxqTempx86\7zSD.sfx -ErrorAction Ignore
			Invoke-WebRequest -Uri "https://hg.mozilla.org/mozilla-central/raw-file/tip/browser/installer/windows/app.tag" -OutFile $TempDir\FireFoxqTempx86\app.tag -ErrorAction Ignore

			cmd /c copy /B $TempDir\FireFoxqTempx86\7zSD.sfx+$TempDir\FireFoxqTempx86\app.tag+$TempDir\FireFoxqTempx86\app.7z $DestinationPath\FirefoxQuantumx86.exe

			Pop-Location
			</ExtraCopyFunctions>
			<FullVersion></FullVersion>
			<Version></Version>
			<AppRepoFolder>x86EN</AppRepoFolder>
		</Download>
		<Download DeploymentType="DeploymentType3">
			<PrefetchScript>
			$Version = (ConvertFrom-JSON (Invoke-WebRequest -URI "https://product-details.mozilla.org/1.0/firefox_versions.json").Content).FIREFOX_ESR		
			$URL = "https://download.mozilla.org/?product=firefox-$Version-SSL&amp;os=win64&amp;lang=cs"
			$Version = $Version -replace "esr",""
			</PrefetchScript>
			<URL></URL>
			<DownloadFileName>FirefoxQuantumx64_CZ.exe</DownloadFileName>
			<ExtraCopyFunctions>
			&amp; $ScriptRoot\7za.exe x "$TempDir\FirefoxQuantumx64_CZ.exe" -o"$TempDir\FireFoxqTempx64CZ" -y
			Push-Location
			Copy-Item -Path "$ScriptRoot`\Extra\Mozilla Firefox Quantum\*" -exclude "firefox.ini" -Destination "$TempDir\FireFoxqTempx64CZ\core" -Recurse
			
			&amp;$ScriptRoot\7za.exe a -r -t7z $TempDir\FireFoxqTempx64CZ\app.7z -mx -m0=BCJ2 -m1=LZMA:d24 -m2=LZMA:d19 -m3=LZMA:d19 -mb0:1 -mb0s1:2 -mb0s2:3 $TempDir\FireFoxqTempx64CZ\*

			Invoke-WebRequest -Uri "https://hg.mozilla.org/mozilla-central/raw-file/tip/other-licenses/7zstub/firefox/7zSD.Win32.sfx" -OutFile $TempDir\FireFoxqTempx64CZ\7zSD.sfx -ErrorAction Ignore
			Invoke-WebRequest -Uri "https://hg.mozilla.org/mozilla-central/raw-file/tip/browser/installer/windows/app.tag" -OutFile $TempDir\FireFoxqTempx64CZ\app.tag -ErrorAction Ignore

			cmd /c copy /B $TempDir\FireFoxqTempx64CZ\7zSD.sfx+$TempDir\FireFoxqTempx64CZ\app.tag+$TempDir\FireFoxqTempx64CZ\app.7z $DestinationPath\FirefoxQuantumx64_CZ.exe

			Pop-Location
			</ExtraCopyFunctions>
			<FullVersion></FullVersion>
			<Version></Version>
			<AppRepoFolder>x64CZ</AppRepoFolder>
		</Download>
	</Downloads>
	<DeploymentTypes>
		<DeploymentType Name="DeploymentType3">
			<DeploymentTypeName>Firefox Quantum ESR CZ x64 Silent Install</DeploymentTypeName>
			<InstallationType>Script</InstallationType>
			<InstallationBehaviorName>firefox.exe</InstallationBehaviorName>
			<CacheContent>False</CacheContent>
			<BranchCache>True</BranchCache>
			<ContentFallback>True</ContentFallback>
			<OnSlowNetwork>Download</OnSlowNetwork>
			<InstallProgram>cmd /c FirefoxQuantumx64_CZ.exe /S /INI="%cd%\firefox.ini" &amp;&amp; DEL /Q "%public%\Desktop\Firefox.lnk" || exit /b 0</InstallProgram>
			<UninstallCmd>cmd /c "%ProgramFiles%\Mozilla Firefox\uninstall\helper.exe" -ms &amp;&amp; ping -n 5 127.0.0.1</UninstallCmd>
			<InstallationBehaviorType>InstallForSystem</InstallationBehaviorType>
			<LogonReqType>WhetherOrNotUserLoggedOn</LogonReqType>
			<UserInteractionMode>Hidden</UserInteractionMode>
			<EstRuntimeMins>5</EstRuntimeMins>
			<MaxRuntimeMins>20</MaxRuntimeMins>
			<RebootBehavior>BasedOnExitCode</RebootBehavior>
			<DetectionMethodType>Custom</DetectionMethodType>
			<CustomDetectionMethods>
				<DetectionClause>
					<DetectionClauseType>RegistryKeyValue</DetectionClauseType>
					<Hive>LocalMachine</Hive>
					<KeyName>SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\Mozilla Firefox $Version ESR (x64 cs)</KeyName>
					<ValueName>DisplayVersion</ValueName>
					<PropertyType>String</PropertyType>
					<ExpectedValue>$Version</ExpectedValue>
					<Value>true</Value>
					<ExpressionOperator>IsEquals</ExpressionOperator>
					<Is64Bit>true</Is64Bit>
				</DetectionClause>
			</CustomDetectionMethods>
			<Requirements>
				<RuleName>OS Architecture x64</RuleName>
				<RuleName>OS Language CZECH</RuleName>
			</Requirements>
			<Supersedence>true</Supersedence>
		</DeploymentType>
		<DeploymentType Name="DeploymentType1">
			<DeploymentTypeName>Firefox Quantum ESR x64 Silent Install</DeploymentTypeName>
			<InstallationType>Script</InstallationType>
			<InstallationBehaviorName>firefox.exe</InstallationBehaviorName>
			<CacheContent>False</CacheContent>
			<BranchCache>True</BranchCache>
			<ContentFallback>True</ContentFallback>
			<OnSlowNetwork>Download</OnSlowNetwork>
			<InstallProgram>cmd /c FirefoxQuantumx64.exe /S /INI="%cd%\firefox.ini" &amp;&amp; DEL /Q "%public%\Desktop\Firefox.lnk" || exit /b 0</InstallProgram>
			<UninstallCmd>cmd /c "%ProgramFiles%\Mozilla Firefox\uninstall\helper.exe" -ms &amp;&amp; ping -n 5 127.0.0.1</UninstallCmd>
			<InstallationBehaviorType>InstallForSystem</InstallationBehaviorType>
			<LogonReqType>WhetherOrNotUserLoggedOn</LogonReqType>
			<UserInteractionMode>Hidden</UserInteractionMode>
			<EstRuntimeMins>5</EstRuntimeMins>
			<MaxRuntimeMins>20</MaxRuntimeMins>
			<RebootBehavior>BasedOnExitCode</RebootBehavior>
			<DetectionMethodType>Custom</DetectionMethodType>
			<CustomDetectionMethods>
 					<DetectionClause>
						<DetectionClauseType>RegistryKeyValue</DetectionClauseType>
	                    <Hive>LocalMachine</Hive>
	                    <KeyName>SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\Mozilla Firefox $Version ESR (x64 en-US)</KeyName>
						<ValueName>DisplayVersion</ValueName>
						<PropertyType>String</PropertyType>
						<ExpectedValue>$Version</ExpectedValue>
	                    <Value>true</Value>
						<ExpressionOperator>IsEquals</ExpressionOperator>
	                    <Is64Bit>true</Is64Bit>
					</DetectionClause>
			</CustomDetectionMethods>
			<Requirements>
				<RuleName>OS Architecture x64</RuleName>
			</Requirements>
			<Supersedence>true</Supersedence>
		</DeploymentType>
		<DeploymentType Name="DeploymentType2">
			<DeploymentTypeName>Firefox Quantum ESR x86 Silent Install</DeploymentTypeName>
			<InstallationType>Script</InstallationType>
			<InstallationBehaviorName>firefox.exe</InstallationBehaviorName>
			<CacheContent>False</CacheContent>
			<BranchCache>True</BranchCache>
			<ContentFallback>True</ContentFallback>
			<OnSlowNetwork>Download</OnSlowNetwork>
			<InstallProgram>cmd /c FirefoxQuantumx86.exe /S /INI="%cd%\firefox.ini" &amp;&amp; DEL /Q "%public%\Desktop\Firefox.lnk" || exit /b 0</InstallProgram>
			<UninstallCmd>cmd /c "%ProgramFiles(x86)%\Mozilla Firefox\uninstall\helper.exe" -ms &amp;&amp; ping -n 5 127.0.0.1</UninstallCmd>
			<InstallationBehaviorType>InstallForSystem</InstallationBehaviorType>
			<LogonReqType>WhetherOrNotUserLoggedOn</LogonReqType>
			<UserInteractionMode>Hidden</UserInteractionMode>
			<EstRuntimeMins>5</EstRuntimeMins>
			<MaxRuntimeMins>20</MaxRuntimeMins>
			<RebootBehavior>BasedOnExitCode</RebootBehavior>
			<DetectionMethodType>Custom</DetectionMethodType>
			<CustomDetectionMethods>
				<DetectionClause>
					<DetectionClauseType>RegistryKeyValue</DetectionClauseType>
					<Hive>LocalMachine</Hive>
					<KeyName>SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\Mozilla Firefox $Version ESR (x86 en-US)</KeyName>
					<ValueName>DisplayVersion</ValueName>
					<PropertyType>String</PropertyType>
					<ExpectedValue>$Version</ExpectedValue>
					<Value>true</Value>
					<ExpressionOperator>IsEquals</ExpressionOperator>
					<Is64Bit>false</Is64Bit>
				</DetectionClause>
			</CustomDetectionMethods>
			<Requirements>
				<RuleName>OS Architecture x86</RuleName>
			</Requirements>
			<Supersedence>true</Supersedence>
		</DeploymentType>
	</DeploymentTypes>
	<Distribution>
		<DistributeContent>True</DistributeContent>
	</Distribution>
	<Tasksquences>
		<TasksquenceID>MU1002EE</TasksquenceID>
	</Tasksquences>
	<Deployments TestFirst="True">
		<Deployment type="Test">
			<DeploySoftware>True</DeploySoftware>
			<DeployAction>Install</DeployAction>
			<DeployPurpose>Required</DeployPurpose>
			<UserNotification>DisplaySoftwareCenterOnly</UserNotification>
			<DeploymentCollection>WKS - SD - Mozilla Firefox - TEST</DeploymentCollection>
		</Deployment>
		<Deployment>
			<DeploySoftware>True</DeploySoftware>
			<DeployAction>Install</DeployAction>
			<DeployPurpose>Available</DeployPurpose>
			<UserNotification>DisplaySoftwareCenterOnly</UserNotification>
			<DeploymentCollection>WKS - SD - Mozilla Firefox - Available - CSS</DeploymentCollection>
		</Deployment>
		<Deployment>
			<DeploySoftware>True</DeploySoftware>
			<DeployAction>Install</DeployAction>
			<DeployPurpose>Required</DeployPurpose>
			<UserNotification>DisplaySoftwareCenterOnly</UserNotification>
			<DeploymentCollection>WKS - SD - Mozilla Firefox - Required - CSS</DeploymentCollection>
		</Deployment>
	</Deployments>
</ApplicationDef>
